---
import { marked } from 'marked';
import matter from 'gray-matter';
import fs from 'fs/promises';
import path from 'path';

export async function getStaticPaths() {
    const notesDir = path.join(process.cwd(), 'src/notes');
    const files = await fs.readdir(notesDir);
    const markdownFiles = files.filter(file => file.endsWith('.md'));

    return markdownFiles.map(file => ({
        params: { slug: file.replace('.md', '') }
    }));
}

const { slug } = Astro.params;
const filePath = path.join(process.cwd(), 'src/notes', `${slug}.md`);
const rawContent = await fs.readFile(filePath, 'utf-8');

const { data: frontmatter, content } = matter(rawContent);
const htmlContent = marked(content);
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <title>{frontmatter.title}</title>
    </head>
    <body>
        <a href="/">&larr; Back to Home</a>
        <h1>{frontmatter.title}</h1>
        <p>Published on: {frontmatter.publishDate}</p>
        <hr />
        <div set:html={htmlContent} />
    </body>
</html>